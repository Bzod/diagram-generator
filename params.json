{"name":"diagram-generator","tagline":"","body":"<!Doctype html>\r\n<html>\r\n<head>\r\n\t<meta charset=\"utf-8\">\r\n\t<title>Определение точек картинки</title>\r\n\r\n\t<script src=\"http://code.jquery.com/jquery-1.11.1.min.js\"></script>\r\n\t<script type=\"text/javascript\">\r\n\t\t$(document).ready(function(){\r\n\t\t\tfunction readURL(input) {\r\n\r\n\t\t\t    if (input.files && input.files[0]) {\r\n\t\t\t        var reader = new FileReader();\r\n\r\n\t\t\t        reader.onload = function (e) {\r\n\t\t\t            $('#blah').attr('src', e.target.result);\r\n\t\t\t            showImgSize();\r\n\t\t\t        }\r\n\r\n\t\t\t        reader.readAsDataURL(input.files[0]);\r\n\t\t\t    }\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t$(\"#imgInp\").change(function(){\r\n\t\t\t    readURL(this);\r\n\t\t\t    \r\n\t\t\t});\r\n\r\n\r\n\r\n//*************************************************************************************\r\n\t\t\tString.prototype.format = String.prototype.f = function() {\r\n\t\t\t    var s = this,\r\n\t\t\t        i = arguments.length;\r\n\r\n\t\t\t    while (i--) {\r\n\t\t\t        s = s.replace(new RegExp('\\\\{' + i + '\\\\}', 'gm'), arguments[i]);\r\n\t\t\t    }\r\n\t\t\t    return s;\r\n\t\t\t};\r\n\r\n//*************************************************************************************\r\n\t\t\tvar clickNumber = 0;\r\n\t\t\tvar allElements = [];\r\n\t\t\tvar x1 = 0;\r\n\t\t\tvar y1 = 0;\r\n\t\t\tvar x2 = 0;\r\n\t\t\tvar y2 = 0;\r\n\t\t\tvar imageSize = [0, 0];\r\n\r\n\r\n\t\t\tfunction isIntervalsCrosseds(a1, a2, b1, b2){\r\n\t\t\t\tif ( ((a1 < b1) && ( a2 > b1)) || ((a1 > b1) && (a1 < b2)) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\tfunction showImgSize(){\r\n\t\t\t\tvar height =  $(\"#img-wrapper\").height();\r\n\t\t\t\tvar width = $(\"#img-wrapper\").width();\r\n\t\t\t\timageSize[0] = width;\r\n\t\t\t\timageSize[1] = height;\r\n\t\t\t\t$(\"#img-size\").html(\"Ширина: \" + width + \"<br>Высота: \" + height);\r\n\t\t\t}\r\n\r\n\t\t\tfunction getPercent(x) {\r\n\t\t\t\treturn x/$(\"#img-wrapper\").width()*100 | 0;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getParagraph() {\r\n\t\t\t\tparagraph = $(\"#area-generator input\").val();\r\n\t\t\t\treturn paragraph;\r\n\t\t\t}\r\n\r\n\r\n\t\t\t\r\n\r\n\t\t\t$(\"#img-wrapper\").click(function(e){\r\n\t\t\t\tvar x = e.pageX - $(\"#img-wrapper\").position().left;\r\n\t\t\t\tvar y = e.pageY - $(\"#img-wrapper\").position().top;\r\n\t\t\t\t// var percentX = x/$(\"#img-wrapper\").width()*100 | 0;\r\n\t\t\t\t// var percentY = y/$(\"#img-wrapper\").height()*100 | 0;\r\n\t\t\t\tif (clickNumber == 0){\r\n\t\t\t\t\tx1 = x;\r\n\t\t\t\t\ty1 = y;\r\n\t\t\t\t\tclickNumber = 1;\r\n\t\t\t\t\tconsole.log(x);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tx2 = x;\r\n\t\t\t\t\ty2 = y;\r\n\t\t\t\t\tclickNumber = 0;\r\n\t\t\t\t\tallElements.push([[x1, y1],[x2, y2]]);\r\n\t\t\t\t\tvar rectangleWidth = x2 - x1;\r\n\t\t\t\t\tvar rectangleHeight = y2 - y1;\r\n\t\t\t\t\t$(\"#rectangles\").append('<div class=\"rectangle-el\" style=\"width: {0}px; height: {1}px; margin-left: {2}px; margin-top: {3}px;\" title=\"x1 = {4}%; y1 = {5}%; x2 = {6}%; y2 = {7}%;\"></div>'.format(rectangleWidth, rectangleHeight, x1, y1, getPercent(x1), getPercent(y1), getPercent(x2), getPercent(y2)));\r\n\t\t\t\t\tconsole.log(x);\r\n\t\t\t\t\t$(\"ol#xy\").append('<li>x1 = {0}%; y1 = {1}%; x2 = {2}%; y2 = {3}%;<span class=\"remove-item\">(remove)</span></li>'.format(getPercent(x1), getPercent(y1), getPercent(x2), getPercent(y2)));\r\n\t\t\t\t\t// $(\"ol#xy\").append(\"<li>x1: {0}%; y1: {1}%; x2 = {2}%; y2 ={3}%;<span class='remove-item'>(remove)</span></li>\".format(1, 2, 2, 3);\r\n\t\t\t\t}\r\n\t\t\t\t// $(\"#pos-x\").text(\"x\");\r\n\t\t\t\t// $(\"#percent-x\").text(percentX);\r\n\t\t\t\t// $(\"#pos-y\").text(y);\r\n\t\t\t\t// $(\"#percent-y\").text(percentY);\r\n\t\t\t\t\r\n\t\t\t\tconsole.log(allElements);\r\n\t\t\t});\r\n\r\n\t\t\t$(document).on('click', \".remove-item\",function(){\r\n\t\t\t\tvar thisIndex = $(this).parent().index();\r\n\t\t\t\tconsole.log(allElements);\r\n\t\t\t\tallElements.splice(thisIndex, 1);\r\n\t\t\t\tconsole.log(allElements);\r\n\t\t\t\t$(this).parent().remove();\r\n\t\t\t\t$(\"#rectangles\").children().eq(thisIndex).remove();\r\n\t\t\t});\r\n\r\n\r\n\t\t\tfunction findLeft(listOfRectangles, x, y1, y2) {\r\n\t\t\t\tvar listLength = listOfRectangles.length;\r\n\t\t\t\tvar foundIndex = -1;\r\n\t\t\t\tvar distance = x;\r\n\t\t\t\tfor (i = 0; i < listLength; i++) {\r\n\t\t\t\t\tif ( isIntervalsCrosseds(listOfRectangles[i][0][1], listOfRectangles[i][1][1], y1, y2) ) {\r\n\t\t\t\t\t\tvar thisDistance = x - listOfRectangles[i][1][0];\r\n\t\t\t\t\t\tif ( ( thisDistance > 0 ) && ( thisDistance < distance) ) {\r\n\t\t\t\t\t\t\tdistance = thisDistance;\r\n\t\t\t\t\t\t\tfoundIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(distance);\r\n\t\t\t\treturn [i, distance];\r\n\t\t\t}\r\n\r\n\t\t\tfunction findTop(listOfRectangles, y, x1, x2) {\r\n\t\t\t\tvar listLength = listOfRectangles.length;\r\n\t\t\t\tvar foundIndex = -1;\r\n\t\t\t\tvar distance = y;\r\n\t\t\t\tfor (i = 0; i < listLength; i++) {\r\n\t\t\t\t\tif ( isIntervalsCrosseds(listOfRectangles[i][0][0], listOfRectangles[i][1][0], x1, x2) ) {\r\n\t\t\t\t\t\tvar thisDistance = y - listOfRectangles[i][1][1];\r\n\t\t\t\t\t\tif ( ( thisDistance > 0 ) && ( thisDistance < distance) ) {\r\n\t\t\t\t\t\t\tdistance = thisDistance;\r\n\t\t\t\t\t\t\tfoundIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(distance);\r\n\t\t\t\treturn [i, distance];\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#area-generator button\").click(function(){\r\n\t\t\t\tvar areaText = '';\r\n\t\t\t\tvar arrayLength = allElements.length;\r\n\t\t\t\tfor ( var i = 0; i < arrayLength; i++) {\r\n\t\t\t\t\tvar leftIndent = 0;\r\n\t\t\t\t\tvar topIndent = 0;\r\n\t\t\t\t\tvar elWidth = 0;\r\n\t\t\t\t\tvar elHeight = 0;\r\n\r\n\t\t\t\t\tvar oneArea = '';\r\n\t\t\t\t\tvar paragraph = getParagraph();\r\n\t\t\t\t\tif (i == 0){\r\n\t\t\t\t\t\tleftIndent = allElements[0][0][0]/imageSize[0]*100 | 0;\r\n\t\t\t\t\t\ttopIndent = allElements[0][0][1]/imageSize[0]*100 | 0;\r\n\t\t\t\t\t\telWidth = (allElements[0][1][0] - allElements[0][0][0])/imageSize[0]*100 | 0;\r\n\t\t\t\t\t\telHeight = (allElements[0][1][1] - allElements[0][0][1])/imageSize[0]*100 | 0;\r\n\r\n\t\t\t\t\t\toneArea = '<area left=\"' + leftIndent + '\" top=\"' + topIndent + '\" width=\"' + elWidth + '\" height=\"' + elHeight + '\" action=\"diagram' + paragraph + '_1\" percent=\"yes\"/>';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tleftIndent = getPercent( findLeft(allElements, allElements[i][0][0], allElements[i][0][1], allElements[i][1][1] )[1] );\r\n\t\t\t\t\t\ttopIndent = getPercent( findTop(allElements, allElements[i][0][1], allElements[i][0][0], allElements[i][1][0] )[1] );\r\n\t\t\t\t\t\telWidth = (allElements[i][1][0] - allElements[i][0][0])/imageSize[0]*100 | 0;\r\n\t\t\t\t\t\telHeight = (allElements[i][1][1] - allElements[i][0][1])/imageSize[0]*100 | 0;\r\n\r\n\t\t\t\t\t\toneArea = '\\n<area left=\"' + leftIndent + '\" top=\"' + topIndent + '\" width=\"' + elWidth + '\" height=\"' + elHeight + '\" action=\"diagram' + paragraph + '_' + (i + 1) + '\" percent=\"yes\"/>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tareaText += oneArea;\r\n\t\t\t\t}\r\n\t\t\t\t//<area left=\"1\" top=\"1\" width=\"24\" height=\"10\" action=\"diagram11_2\" percent=\"yes\"/>\r\n\t\t\t\t$(\"#area-generator textarea\").text(areaText);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t</script>\r\n\t<link rel=\"stylesheet\" href=\"http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css\">\r\n\t<link rel=\"stylesheet\" href=\"http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css\">\r\n\t<style type=\"text/css\">\r\n\t\t.upload{\r\n\t\t\tfloat: top;\r\n\t\t\tmin-height: 70px;\r\n\t\t}\r\n\t\t#form1{\r\n\t\t\tfloat: top;\r\n\t\t}\r\n\t\t#img-wrapper{\r\n\t\t\tfloat: left;\r\n\t\t\toutline: 1px solid #fff;\r\n\t\t\tborder: 1px solid #000;\r\n\t\t\tcursor: crosshair;\r\n\t\t}\r\n\t\t#img-info{\r\n\t\t\tfloat: right;\r\n\t\t\twidth: 160px\r\n\t\t}\r\n\t\t#img-size{\r\n\t\t\twidth: 160px;\r\n\t\t}\r\n\t\t#dot-list{\r\n\t\t\twidth: 360px;\r\n\t\t\tmin-height: 10px;\r\n\t\t\tbackground-color: yellow;\r\n\t\t}\r\n\t\t.remove-item{\r\n\t\t\tcolor: red;\r\n\t\t\tcursor: pointer;\r\n\t\t}\r\n\t\t.remove-item:hover{\r\n\t\t\ttext-decoration: underline;\r\n\t\t}\r\n\t\t#area-generator{\r\n\t\t\tfloat: top;\r\n\t\t\tpadding-top: 20px;\r\n\t\t}\r\n\t\t#area-generator input{\r\n\t\t\twidth: 30px;\r\n\t\t}\r\n\t\t#rectangles{\r\n\t\t\tposition: absolute;\r\n\t\t}\r\n\t\t.rectangle-el{\r\n\t\t\tposition: absolute;\r\n\t\t\topacity: 0.3;\r\n\t\t\tborder: 1px solid #000;\r\n\t\t\tbackground-color: blue;\r\n\t\t}\r\n\t</style>\r\n\r\n</head>\r\n<body>\r\n\t<div class=\"wrapper container\">\r\n\t\t<div class=\"upload\">\r\n\t\t\t<form id=\"form1\" runat=\"server\">\r\n\t\t\t    <input type='file' id=\"imgInp\" />\r\n\t\t\t    <div id=\"img-wrapper\"><div id=\"rectangles\"></div><img id=\"blah\" src=\"#\" alt=\"your image\" /></div>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\r\n\t\t<div id=\"img-info\">\r\n\t\t\t<div id=\"img-size\">\r\n\r\n\t\t\t</div>\r\n\t\t\t<br>\r\n\t\t\t<br>\r\n\t\t\t<div id=\"dot-list\">\r\n\t\t\t\t<ol id=\"xy\">\r\n\t<!-- \t\t\t\tX: <span id=\"pos-x\"></span>\r\n\t\t\t\t\t<br>\r\n\t\t\t\t\tY: <span id=\"pos-y\"></span>\r\n\t\t\t\t\t<br>\r\n\t\t\t\t\t%X: <span id=\"percent-x\"></span>\r\n\t\t\t\t\t<br>\r\n\t\t\t\t\t%Y: <span id=\"percent-y\"></span> -->\r\n\t\t\t\t</ol>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div id=\"area-generator\" class=\"col-md-12\">\r\n\t\t\tИмя: diagram<input type=\"text\">_n\r\n\t\t\t<textarea  class=\"form-control\"></textarea>\r\n\t\t\t<br>\r\n\t\t\t<button class=\"btn btn-primary\">Сгенерировать area <i class=\"icon-white icon-refresh\"></i></button>\r\n\t\t</div>\r\n\t</div>\r\n\r\n</body>\r\n</html>","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}